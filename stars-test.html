<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stars Test - Forward Motion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: monospace;
        }
        #canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="info">
        <h2 style="margin-bottom: 10px;">Stars Test - Forward Motion</h2>
        <p>You should see stars moving toward you (getting bigger and brighter)</p>
        <p id="stats" style="margin-top: 10px;">Stars: 500 | FPS: 0</p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        if (!canvas) {
            console.error('Canvas not found!');
        }
        const ctx = canvas.getContext('2d', { alpha: true });
        if (!ctx) {
            console.error('Could not get 2d context!');
        }
        
        let w = canvas.width = window.innerWidth;
        let h = canvas.height = window.innerHeight;

        let stars = [];
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 0;

        // --- Cached gradient texture for stars ---
        const starTexture = document.createElement('canvas');
        const ctx2 = starTexture.getContext('2d');
        starTexture.width = 100;
        starTexture.height = 100;
        const half = starTexture.width / 2;
        const gradient = ctx2.createRadialGradient(half, half, 0, half, half, half);
        gradient.addColorStop(0, '#ffffff');
        gradient.addColorStop(0.2, 'rgba(255, 255, 255, 0.8)');
        gradient.addColorStop(0.4, 'rgba(200, 220, 255, 0.4)');
        gradient.addColorStop(1, 'transparent');
        ctx2.fillStyle = gradient;
        ctx2.beginPath();
        ctx2.arc(half, half, half, 0, Math.PI * 2);
        ctx2.fill();

        // --- Utility function ---
        const random = (min, max) => {
            return Math.random() * (max - min) + min;
        };

        // --- Star class with 3D forward motion ---
        class Star {
            constructor() {
                // Random starting position in 3D space
                this.x = random(-w * 0.5, w * 0.5);
                this.y = random(-h * 0.5, h * 0.5);
                this.z = random(100, 2000); // Start at various depths
                this.speed = random(0.5, 3);
                this.baseRadius = random(1, 3);
            }

            update() {
                // Move star forward (toward camera, decreasing Z)
                this.z -= this.speed;

                // Reset star when it gets too close (passes camera)
                if (this.z <= 0) {
                    this.x = random(-w * 0.5, w * 0.5);
                    this.y = random(-h * 0.5, h * 0.5);
                    this.z = 2000; // Reset to far distance
                }
            }

            draw() {
                // Perspective projection
                const perspective = 500;
                const scale = perspective / (perspective + this.z);
                
                // Project 3D position to 2D screen (center of screen is origin)
                const screenX = (this.x * scale) + w / 2;
                const screenY = (this.y * scale) + h / 2;
                
                // Scale star size based on distance (closer = bigger)
                const radius = this.baseRadius * scale * 5;
                
                // Calculate opacity based on distance (closer = brighter)
                const distanceAlpha = Math.min(1, (2000 - this.z) / 1000);
                ctx.globalAlpha = distanceAlpha * 0.8;

                // Draw the star if it's on screen
                if (screenX >= -radius && screenX <= w + radius && 
                    screenY >= -radius && screenY <= h + radius && 
                    radius > 0.5) {
                    ctx.drawImage(
                        starTexture, 
                        screenX - radius / 2, 
                        screenY - radius / 2, 
                        radius, 
                        radius
                    );
                }
            }
        }

        // Initialize stars
        for (let i = 0; i < 500; i++) {
            stars.push(new Star());
        }

        console.log('Initialized', stars.length, 'stars');

        // --- Animation loop ---
        const animate = (currentTime) => {
            // Calculate FPS
            frameCount++;
            if (currentTime - lastTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                lastTime = currentTime;
                document.getElementById('stats').textContent = `Stars: ${stars.length} | FPS: ${fps}`;
            }

            // Clear canvas with subtle fade for trails
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, w, h);

            // Update and draw stars
            ctx.globalCompositeOperation = 'lighter';
            for (let i = 0; i < stars.length; i++) {
                stars[i].update();
                stars[i].draw();
            }

            requestAnimationFrame(animate);
        };

        // Start animation
        requestAnimationFrame(animate);
        console.log('Animation started');

        // --- Resize handling ---
        window.addEventListener('resize', () => {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
